// Полная база данных карт Таро с профессиональными трактовками
// Трактовки написаны в стиле опытного таролога с глубоким анализом

import type { Card } from '../types'

// Старшие Арканы - Major Arcana (0-21)
export const majorArcana: Card[] = [
  {
    id: 'major_00_fool',
    nameRu: 'Шут',
    nameEn: 'The Fool',
    arcana: 'major',
    number: 0,
    keywords: ['начало', 'свобода', 'спонтанность', 'невинность', 'вера'],
    meaningUpright: {
      general: `Шут — это карта новых начинаний и безграничных возможностей. Она говорит о моменте, когда ты стоишь на пороге чего-то совершенно нового, неизведанного. Вселенная приглашает тебя сделать шаг в неизвестность с открытым сердцем и доверием к своему пути.

Эта карта несёт энергию чистого потенциала. Подобно ребёнку, который ещё не знает страха, ты сейчас можешь действовать без оглядки на прошлые неудачи. Именно эта лёгкость и открытость помогут тебе найти нестандартные решения.`,
      love: `В любви Шут предвещает свежий ветер перемен. Если ты одинока — готовься к неожиданной встрече, возможно, в самом непредсказуемом месте. Эта связь может показаться нелогичной, но именно в спонтанности кроется её магия.

Если ты в отношениях — карта призывает вернуть искру и лёгкость первых дней. Попробуйте что-то новое вместе, удивите друг друга. Отпустите серьёзность и позвольте себе просто наслаждаться.`,
      career: `В карьере Шут указывает на прекрасное время для нового проекта или даже смены направления. Не бойся выглядеть «неопытной» — твой свежий взгляд и энтузиазм сейчас важнее опыта. Идеи, которые кажутся другим «сумасшедшими», могут привести тебя к успеху.`,
      advice: `Доверься потоку жизни и не пытайся всё контролировать. Сегодня твоя сила — в способности быть открытой новому, не цепляясь за старые схемы. Сделай тот шаг, о котором давно мечтаешь, но боишься — вселенная тебя поддержит.`,
    },
    meaningReversed: {
      general: `Перевёрнутый Шут предупреждает о безрассудстве и игнорировании важных знаков. Возможно, ты торопишься с решением, не продумав последствия, или наоборот — страх неизвестности парализует тебя на месте.

Эта карта также может указывать на внутреннего критика, который душит твои порывы фразами «это глупо», «у тебя не получится». Важно найти баланс между разумной осторожностью и парализующим страхом.`,
      love: `В любви перевёрнутый Шут говорит о поверхностности или нежелании брать на себя ответственность. Возможно, кто-то играет с твоими чувствами или ты сама избегаешь глубины. Также карта может указывать на страх обязательств.`,
      career: `Осторожно с импульсивными решениями в карьере. Перевёрнутый Шут предупреждает: не бросай стабильность ради миража. Проверь «заманчивые предложения» тщательнее. Также может означать саботаж своих же идей из-за неуверенности.`,
      advice: `Остановись и подумай, прежде чем прыгать. Но не позволяй страху полностью тебя остановить. Найди золотую середину между безрассудством и параличом.`,
    },
    zodiacConnections: ['Уран'],
    element: 'Воздух',
  },
  {
    id: 'major_01_magician',
    nameRu: 'Маг',
    nameEn: 'The Magician',
    arcana: 'major',
    number: 1,
    keywords: ['сила воли', 'мастерство', 'проявление', 'концентрация', 'действие'],
    meaningUpright: {
      general: `Маг — одна из самых мощных карт колоды. Она говорит о том, что прямо сейчас у тебя есть все инструменты и ресурсы для воплощения своих желаний в реальность. Ты — проводник между мирами: небо (идеи) и земля (материя) соединяются через тебя.

На столе перед Магом лежат все четыре масти — символы всех сфер жизни. Это означает, что ты располагаешь всеми необходимыми элементами: силой воли (жезлы), эмоциональной глубиной (кубки), интеллектом (мечи) и практичностью (пентакли).`,
      love: `В любви Маг говорит о твоей магнетической притягательности. Ты сейчас невероятно привлекательна — не только внешне, но и энергетически. Используй эту силу мудро.

Если ты хочешь кого-то привлечь — действуй! Карта говорит, что у тебя есть все шансы. Если в отношениях — время проявить инициативу, создать что-то новое вместе.`,
      career: `Профессионально это великолепное время. Твои идеи, навыки и упорство сходятся в одной точке — используй этот момент! Начинай проекты, заявляй о себе, договаривайся о повышении. Вселенная поддерживает твои амбиции.`,
      advice: `Ты — создатель своей реальности. Перестань ждать «идеального момента» — он наступил. Сфокусируйся на главной цели и направь на неё всю свою энергию. Помни: мысли материальны, особенно сегодня.`,
    },
    meaningReversed: {
      general: `Перевёрнутый Маг предупреждает о неиспользованном потенциале или, наоборот, о манипуляциях. С одной стороны, ты можешь не замечать своих возможностей, с другой — кто-то может использовать силу убеждения против тебя.

Также карта указывает на рассеянность энергии. Ты пытаешься делать всё сразу и в итоге не достигаешь ничего. Или используешь свои таланты для обмана — своего или чужого.`,
      love: `В любви перевёрнутый Маг может говорить о манипуляторе рядом с тобой — человеке, который использует слова и обаяние для своих целей. Будь осторожна с теми, кто слишком гладко говорит. Также может означать твою неспособность выразить чувства.`,
      career: `Возможен обман в деловой сфере — внимательно читай контракты. Также карта указывает на синдром самозванца или страх проявить себя. Ты недооцениваешь свои способности.`,
      advice: `Разберись с тем, что блокирует твою силу. Это может быть неуверенность, распыление внимания или чьё-то негативное влияние. Верни себе контроль над своей энергией.`,
    },
    zodiacConnections: ['Меркурий'],
    element: 'Воздух',
  },
  {
    id: 'major_02_high_priestess',
    nameRu: 'Верховная Жрица',
    nameEn: 'The High Priestess',
    arcana: 'major',
    number: 2,
    keywords: ['интуиция', 'тайна', 'мудрость', 'подсознание', 'терпение'],
    meaningUpright: {
      general: `Верховная Жрица — хранительница тайного знания, которое нельзя постичь разумом. Она сидит между двух колонн — светлой и тёмной — показывая, что истина находится в балансе, в точке между противоположностями.

Эта карта говорит: сейчас не время для активных действий. Время слушать свою интуицию, обращать внимание на сны, замечать знаки. Ответы уже есть внутри тебя, просто прислушайся.`,
      love: `В любви Жрица указывает на скрытые чувства — свои или партнёра. Что-то важное пока не выражено словами, но существует на глубинном уровне. Не торопи события, позволь всему раскрыться естественно.

Если ты одинока — возможно, кто-то тайно влюблён в тебя. Или ты сама ещё не осознала свои чувства к кому-то.`,
      career: `Профессионально карта советует собирать информацию, но пока не действовать. Не всё то, что кажется, является правдой. Используй свою интуицию при принятии решений — логика сейчас не покажет полной картины.`,
      advice: `Замедлись и прислушайся к тишине. В ней — ответы на твои вопросы. Веди дневник снов, медитируй, проводи время в одиночестве. Твоя интуиция сейчас — твой главный советник.`,
    },
    meaningReversed: {
      general: `Перевёрнутая Жрица говорит о том, что ты игнорируешь свою интуицию, заглушая её голос рациональным умом или чужими мнениями. Также может означать раскрытие тайн — того, что было скрыто.

Карта предупреждает о поверхностности суждений, нежелании смотреть глубже. Ты можешь упустить важное, потому что не хочешь видеть всей правды.`,
      love: `В отношениях перевёрнутая Жрица может указывать на секреты, которые выходят наружу. Также карта говорит о подавленной сексуальности или отказе от своей женской силы. Возможно, ты не слышишь, что тебе на самом деле нужно в любви.`,
      career: `Скрытая информация может всплыть — будь готова. Также карта предупреждает о недостатке глубины в работе или игнорировании своих истинных профессиональных желаний ради «стабильности».`,
      advice: `Верни связь с внутренним голосом. Ты знаешь больше, чем думаешь — просто позволь себе это осознать. Не прячься от правды, какой бы неудобной она ни была.`,
    },
    zodiacConnections: ['Луна'],
    element: 'Вода',
  },
  {
    id: 'major_03_empress',
    nameRu: 'Императрица',
    nameEn: 'The Empress',
    arcana: 'major',
    number: 3,
    keywords: ['изобилие', 'творчество', 'женственность', 'плодородие', 'красота'],
    meaningUpright: {
      general: `Императрица — воплощение женской творческой силы и изобилия. Она окружена пышной природой, символизирующей бесконечный потенциал роста и процветания. Эта карта говорит о том, что сейчас время собирать плоды своих трудов и наслаждаться красотой жизни.

Императрица напоминает о важности заботы о себе и связи с телом. Она призывает создавать красоту вокруг себя, питать и взращивать — будь то идеи, отношения или буквально живые существа.`,
      love: `В любви Императрица — потрясающий знак! Она говорит о глубокой, питающей любви, которая помогает расцветать обоим партнёрам. Если ты одинока — вселенная готовит тебе встречу с человеком, который будет обожать тебя.

Карта также может указывать на беременность или творческий «плод» в отношениях — совместный проект, дом, общую мечту.`,
      career: `Профессионально время благоприятно для творческих начинаний. Твои идеи сейчас особенно плодотворны — развивай их, не бойся проявлять креативность. Также может означать прибыль, повышение или успешное завершение проекта.`,
      advice: `Позволь себе наслаждаться жизнью прямо сейчас, не откладывая на потом. Окружи себя красотой, балуй тело и душу. Ты заслуживаешь изобилия — просто прими его.`,
    },
    meaningReversed: {
      general: `Перевёрнутая Императрица говорит о блокировке творческой энергии или чрезмерной зависимости от материального. Возможно, ты забыла о своих потребностях, отдавая всё другим. Или наоборот — утонула в удовольствиях, игнорируя обязательства.

Карта также может указывать на проблемы с принятием своей женственности или телесности.`,
      love: `В любви перевёрнутая Императрица может означать дисбаланс «давать-получать». Одна сторона отдаёт слишком много, другая — только принимает. Также может говорить о проблемах с зачатием или страхе материнства.`,
      career: `Творческий блок или застой в делах. Возможно, ты игнорируешь свои таланты или работаешь в неподходящей среде. Также карта предупреждает о финансовых трудностях из-за расточительства.`,
      advice: `Верни баланс в жизнь. Научись как давать, так и принимать. Позаботься о себе — твоя способность создавать зависит от твоего внутреннего состояния.`,
    },
    zodiacConnections: ['Венера'],
    element: 'Земля',
  },
  {
    id: 'major_06_lovers',
    nameRu: 'Влюблённые',
    nameEn: 'The Lovers',
    arcana: 'major',
    number: 6,
    keywords: ['любовь', 'выбор', 'гармония', 'единение', 'ценности'],
    meaningUpright: {
      general: `Влюблённые — это карта о глубокой связи, осознанном выборе и гармонии противоположностей. На карте мужчина и женщина стоят под благословением ангела — символ того, что истинное соединение поддерживается высшими силами.

Но эта карта не только о романтике. Она говорит о важном жизненном выборе, который должен быть сделан в согласии с твоими глубинными ценностями. Этот выбор определит твой дальнейший путь.`,
      love: `В любви это одна из самых благоприятных карт! Она говорит о встрече родственной души или выходе отношений на новый, более глубокий уровень. Сейчас возможно соединение не только тел, но и душ.

Если ты одинока — готовься к судьбоносной встрече. Если в отношениях — время для важного решения: переезд вместе, помолвка, совместные планы.`,
      career: `В карьере Влюблённые указывают на важный выбор между двумя путями. Этот выбор должен соответствовать твоим ценностям, а не только финансовым интересам. Также карта может говорить об успешном партнёрстве или коллаборации.`,
      advice: `Следуй за своим сердцем, но не отключай голову. Сейчас время сделать выбор, который будет в гармонии с твоей истинной сущностью. Не иди на компромисс со своими ценностями ради внешней выгоды.`,
    },
    meaningReversed: {
      general: `Перевёрнутые Влюблённые говорят о дисгармонии, неверном выборе или избегании принятия решения. Возможно, ты идёшь против своих ценностей или разрываешься между двумя вариантами, не способная выбрать.

Карта также может указывать на разлад в важных отношениях или внутренний конфликт.`,
      love: `В любви это сложный знак. Может означать несовместимость, разлад ценностей, ложь или присутствие третьего человека. Также карта говорит о страхе близости или неспособности сделать выбор между партнёрами.`,
      career: `Неудачное партнёрство или конфликт интересов. Также может означать работу, которая противоречит твоим ценностям, но ты боишься уйти. Пора пересмотреть приоритеты.`,
      advice: `Честно признай, чего ты на самом деле хочешь. Избегание выбора — тоже выбор, и он ведёт к стагнации. Послушай своё сердце и сделай шаг, даже если страшно.`,
    },
    zodiacConnections: ['Близнецы'],
    element: 'Воздух',
  },
  // Добавим ещё несколько ключевых карт
  {
    id: 'major_10_wheel',
    nameRu: 'Колесо Фортуны',
    nameEn: 'Wheel of Fortune',
    arcana: 'major',
    number: 10,
    keywords: ['судьба', 'цикл', 'удача', 'перемены', 'карма'],
    meaningUpright: {
      general: `Колесо Фортуны — символ вечного движения жизни. Оно напоминает: что наверху, то и внизу, всё циклично, и эта точка — лишь мгновение в бесконечном танце судьбы. Карта говорит о переломном моменте, когда колесо поворачивается в твою сторону.

Это кармическая карта, указывающая на последствия прошлых действий. Если ты сеяла добро — готовься пожинать удачу. Судьба сейчас благосклонна к тебе.`,
      love: `В любви Колесо предвещает судьбоносный поворот. Одиноким — неожиданную встречу, которая изменит всё. Тем, кто в отношениях — выход на новый уровень или важные перемены. Доверься судьбе — она знает лучше.`,
      career: `Карьерно — великолепное время! Удача на твоей стороне. Используй момент для продвижения, новых проектов, рискованных шагов. Колесо повернулось — хватай возможности.`,
      advice: `Действуй, пока фортуна улыбается! Но помни о смирении — колесо продолжит вращаться. Используй хорошие времена мудро, создавая запас на будущее.`,
    },
    meaningReversed: {
      general: `Перевёрнутое Колесо говорит о сопротивлении переменам или неудачном стечении обстоятельств. Но помни: это лишь временно. Колесо обязательно повернётся снова.

Карта также указывает на кармические уроки, которые нужно пройти, или на попытки контролировать то, что не в твоей власти.`,
      love: `В любви может означать временные трудности или кармические связи, которые требуют проработки. Не отчаивайся — это урок, а не приговор.`,
      career: `Застой или неудачи в делах. Но это время для переосмысления, не для отчаяния. Проанализируй, что пошло не так, и подготовься к следующему повороту колеса.`,
      advice: `Прими то, что не можешь изменить, и найди силу в смирении. Тёмная полоса конечна. Используй это время для внутренней работы.`,
    },
    zodiacConnections: ['Юпитер'],
    element: 'Огонь',
  },
  {
    id: 'major_17_star',
    nameRu: 'Звезда',
    nameEn: 'The Star',
    arcana: 'major',
    number: 17,
    keywords: ['надежда', 'вдохновение', 'исцеление', 'духовность', 'вера'],
    meaningUpright: {
      general: `После тьмы Башни приходит Звезда — знак надежды и исцеления. Обнажённая женщина изливает воду жизни на землю и в воду, символизируя безграничную отдачу и доверие вселенной. Над ней сияют звёзды — напоминание, что свет всегда есть, даже в самой тёмной ночи.

Эта карта приходит после испытаний, чтобы сказать: худшее позади. Время для исцеления, восстановления веры и нового вдохновения.`,
      love: `В любви Звезда — прекрасный знак! Она говорит об исцелении сердечных ран, новой надежде и вере в любовь. Если были трудности — они позади. Если ты одинока — вселенная готовит тебе что-то светлое.`,
      career: `Профессионально карта вдохновляет следовать за мечтой. Твои надежды могут сбыться, если ты продолжишь верить и действовать. Это время для творчества, развития талантов, реализации давних желаний.`,
      advice: `Верь. Даже если сейчас трудно, свет в конце туннеля реален. Позволь себе мечтать и делись своим светом с миром — это приумножит твою надежду.`,
    },
    meaningReversed: {
      general: `Перевёрнутая Звезда говорит о потере надежды, цинизме или неверии в себя. Возможно, прошлые разочарования затмили твой внутренний свет. Но он не погас — просто временно скрыт.`,
      love: `В любви может означать разочарование, неспособность открыться после предательства или нереалистичные ожидания. Время для исцеления, но оно требует осознанной работы.`,
      career: `Потеря направления или вдохновения в работе. Возможно, ты отказалась от мечты ради «реализма». Пора вернуть себе право верить в лучшее.`,
      advice: `Найди источник света внутри себя. Возможно, нужна помощь — терапия, духовная практика, поддержка близких. Не сдавайся на надежду.`,
    },
    zodiacConnections: ['Водолей'],
    element: 'Воздух',
  },
]

// Младшие Арканы - примеры карт
export const minorArcana: Card[] = [
  // Кубки (Cups) - эмоции, отношения
  {
    id: 'cups_01_ace',
    nameRu: 'Туз Кубков',
    nameEn: 'Ace of Cups',
    arcana: 'minor',
    suit: 'cups',
    number: 1,
    keywords: ['новые чувства', 'любовь', 'интуиция', 'творчество', 'изобилие эмоций'],
    meaningUpright: {
      general: `Туз Кубков — чистый дар любви и эмоционального начала. Из кубка изливается пять потоков воды — символ пяти чувств и переполняющих эмоций. Это карта открытия сердца, новых глубоких чувств и духовного пробуждения.`,
      love: `В любви это один из самых прекрасных знаков! Новая любовь стучится в твоё сердце. Или существующие отношения наполняются новой глубиной. Время для признаний, примирений, открытия сердца.`,
      career: `Творческое вдохновение! Работа, которая питает душу. Возможен старт проекта, связанного с эмоциями, помощью людям, искусством.`,
      advice: `Открой своё сердце навстречу любви и радости. Сейчас время получать и давать — позволь эмоциям течь свободно.`,
    },
    meaningReversed: {
      general: `Заблокированные эмоции, подавленные чувства. Возможно, ты боишься открыться или не позволяешь себе чувствовать.`,
      love: `Страх близости, эмоциональная недоступность. Возможно, рана прошлого мешает впустить новое.`,
      career: `Потеря вдохновения, работа без души. Эмоциональное выгорание.`,
      advice: `Разберись с тем, что блокирует твои чувства. Исцеление начинается с признания боли.`,
    },
    zodiacConnections: ['Рак', 'Скорпион', 'Рыбы'],
    element: 'Вода',
  },
  // Жезлы (Wands) - страсть, энергия
  {
    id: 'wands_01_ace',
    nameRu: 'Туз Жезлов',
    nameEn: 'Ace of Wands',
    arcana: 'minor',
    suit: 'wands',
    number: 1,
    keywords: ['творческая искра', 'энтузиазм', 'потенциал', 'начинание', 'страсть'],
    meaningUpright: {
      general: `Туз Жезлов — это вспышка творческого огня, момент вдохновения и зарождения страсти. Рука из облака держит цветущий жезл — символ того, что божественная искра касается земли через тебя.`,
      love: `В любви — страстное начало! Новое увлечение или возрождение страсти в существующих отношениях. Время для смелых шагов.`,
      career: `Блестящая идея или возможность. Старт проекта, который зажигает тебя изнутри. Хватай этот шанс!`,
      advice: `Действуй на волне вдохновения! Пока огонь горит — твори, начинай, рискуй. Но не забудь направить энергию в конкретное русло.`,
    },
    meaningReversed: {
      general: `Задержка старта, угасающий энтузиазм. Идея есть, но нет сил или решимости её реализовать.`,
      love: `Страсть угасает или не может разгореться. Возможно, отношения буксуют.`,
      career: `Упущенные возможности, откладывание проекта. Творческий блок.`,
      advice: `Найди источник своей мотивации. Если огонь угас — что его погасило? Реши это, прежде чем двигаться дальше.`,
    },
    zodiacConnections: ['Овен', 'Лев', 'Стрелец'],
    element: 'Огонь',
  },
]

// Полный набор карт
export const allTarotCards: Card[] = [...majorArcana, ...minorArcana]

// Функция для получения карты по ID
export function getCardById(id: string): Card | undefined {
  return allTarotCards.find(card => card.id === id)
}

// Функция для получения случайной карты
export function getRandomCard(): Card {
  return allTarotCards[Math.floor(Math.random() * allTarotCards.length)]
}

// Fisher-Yates shuffle - профессиональное тасование колоды
function shuffleDeck(deck: Card[]): Card[] {
  const shuffled = [...deck]
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1))
    ;[shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]]
  }
  return shuffled
}

// Вытягивание уникальных карт для расклада
// Как делают профессиональные тарологи:
// 1. Перетасовать колоду
// 2. Вытянуть нужное количество карт (все разные)
// 3. Каждая карта может быть прямой или перевёрнутой (~15% перевёрнутых)
export function drawCardsForSpread(count: number, excludeCardIds: string[] = []): Array<{ card: Card; isReversed: boolean }> {
  // Фильтруем уже использованные карты (для пояснительной карты)
  const availableCards = allTarotCards.filter(card => !excludeCardIds.includes(card.id))

  // Тасуем колоду
  const shuffled = shuffleDeck(availableCards)

  // Вытягиваем нужное количество карт
  const drawnCards = shuffled.slice(0, count)

  // Для каждой карты определяем, перевёрнута ли она
  // ~15% перевёрнутых карт для более позитивных раскладов
  return drawnCards.map(card => ({
    card,
    isReversed: Math.random() < 0.15,
  }))
}

// Вытянуть одну карту, исключая указанные
export function drawSingleCard(excludeCardIds: string[] = []): { card: Card; isReversed: boolean } {
  const available = allTarotCards.filter(card => !excludeCardIds.includes(card.id))
  const shuffled = shuffleDeck(available)
  return {
    card: shuffled[0],
    isReversed: Math.random() < 0.15,
  }
}

// Функция для получения карты дня (детерминированная на основе даты и пользователя)
export function getDailyCard(userId?: string): Card {
  const today = new Date()
  const dateString = `${today.getFullYear()}-${today.getMonth()}-${today.getDate()}`
  const seed = hashString(dateString + (userId || ''))
  return allTarotCards[seed % allTarotCards.length]
}

// Простая хеш-функция
function hashString(str: string): number {
  let hash = 0
  for (let i = 0; i < str.length; i++) {
    const char = str.charCodeAt(i)
    hash = ((hash << 5) - hash) + char
    hash = hash & hash // Convert to 32bit integer
  }
  return Math.abs(hash)
}
