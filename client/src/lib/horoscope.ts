// Гороскопы для каждого знака зодиака
// Обновляются ежедневно на основе даты

export type ZodiacSign =
  | 'Овен' | 'Телец' | 'Близнецы' | 'Рак'
  | 'Лев' | 'Дева' | 'Весы' | 'Скорпион'
  | 'Стрелец' | 'Козерог' | 'Водолей' | 'Рыбы'

interface DailyHoroscope {
  general: string
  love: string
  career: string
  health: string
  luckyNumber: number
  luckyColor: string
  mood: string
  compatibility: ZodiacSign
}

// База гороскопов - по 7 вариантов для каждой категории
const horoscopeDatabase = {
  general: {
    Овен: [
      'Сегодня твоя энергия на высоте! Смело берись за новые проекты.',
      'День идеально подходит для решительных действий и начинаний.',
      'Твоя импульсивность сегодня может стать твоей силой.',
      'Время проявить лидерские качества и взять инициативу в свои руки.',
      'Сегодня звёзды благоволят твоим амбициям.',
      'Используй свою природную решительность - она приведёт к успеху.',
      'День обещает быть насыщенным событиями и возможностями.',
    ],
    Телец: [
      'Сегодня важно сохранять спокойствие и следовать своему плану.',
      'Твоя практичность поможет найти оптимальное решение.',
      'День подходит для финансовых вопросов и планирования.',
      'Доверься своей интуиции в материальных вопросах.',
      'Сегодня твоя надёжность будет особенно оценена окружающими.',
      'Время наслаждаться простыми радостями жизни.',
      'Твоё терпение сегодня принесёт плоды.',
    ],
    Близнецы: [
      'Общение сегодня принесёт неожиданные возможности.',
      'Твоя любознательность откроет новые горизонты.',
      'День благоприятен для обучения и обмена идеями.',
      'Социальные контакты сегодня особенно важны.',
      'Твоя адаптивность поможет справиться с любыми переменами.',
      'Время для новых знакомств и интересных разговоров.',
      'Используй свой дар убеждения - он особенно силён сегодня.',
    ],
    Рак: [
      'Сегодня интуиция подскажет правильный путь.',
      'Домашние дела принесут удовлетворение и комфорт.',
      'Твоя забота о близких вернётся сторицей.',
      'День подходит для семейных встреч и душевных разговоров.',
      'Доверься своим чувствам - они не подведут.',
      'Сегодня важно позаботиться о своём эмоциональном комфорте.',
      'Творческая энергия на подъёме - используй её!',
    ],
    Лев: [
      'Сегодня ты сияешь ярче обычного! Используй это.',
      'Время для творческого самовыражения и признания.',
      'Твоя харизма сегодня притягивает нужных людей.',
      'День идеален для презентаций и публичных выступлений.',
      'Твоя щедрость вдохновит окружающих.',
      'Сегодня звёзды поддерживают твои амбиции.',
      'Время быть в центре внимания - ты это заслуживаешь!',
    ],
    Дева: [
      'Детали сегодня играют важную роль - будь внимательна.',
      'Твой аналитический ум поможет решить сложную задачу.',
      'День подходит для организации и планирования.',
      'Практический подход сегодня особенно эффективен.',
      'Твоё стремление к совершенству принесёт результаты.',
      'Время для наведения порядка - и в делах, и в мыслях.',
      'Сегодня твоя помощь будет особенно ценна для окружающих.',
    ],
    Весы: [
      'Гармония и баланс - твои ключевые слова на сегодня.',
      'Дипломатические способности помогут разрешить конфликт.',
      'День благоприятен для партнёрства и сотрудничества.',
      'Твоё чувство прекрасного сегодня особенно обострено.',
      'Время для принятия важных решений - ты готова.',
      'Справедливость и честность принесут успех.',
      'Сегодня важно найти золотую середину в любом вопросе.',
    ],
    Скорпион: [
      'Твоя интуиция сегодня невероятно сильна.',
      'Глубокие перемены на горизонте - будь готова.',
      'День подходит для раскрытия тайн и поиска истины.',
      'Твоя страсть и целеустремлённость приведут к успеху.',
      'Время для трансформации и обновления.',
      'Сегодня твоя проницательность особенно остра.',
      'Доверься процессу - всё происходит так, как должно.',
    ],
    Стрелец: [
      'Приключения и новые горизонты ждут тебя!',
      'Оптимизм сегодня - твоё главное оружие.',
      'День благоприятен для путешествий и обучения.',
      'Твоя философская натура найдёт новые истины.',
      'Время расширять границы - физические или ментальные.',
      'Сегодня удача на твоей стороне!',
      'Свобода и независимость - твои ключевые ценности сегодня.',
    ],
    Козерог: [
      'Твоё упорство сегодня принесёт заслуженные плоды.',
      'Карьерные вопросы складываются благоприятно.',
      'День подходит для долгосрочного планирования.',
      'Твоя дисциплина и ответственность будут вознаграждены.',
      'Время для важных профессиональных шагов.',
      'Сегодня твой авторитет особенно высок.',
      'Практичный подход приведёт к успеху.',
    ],
    Водолей: [
      'Инновационные идеи витают в воздухе - лови их!',
      'Твоя уникальность сегодня - твоя сила.',
      'День благоприятен для социальных инициатив.',
      'Нестандартное мышление поможет найти решение.',
      'Время для дружеских встреч и командной работы.',
      'Сегодня твоя независимость особенно важна.',
      'Будь верна своим идеалам - они правильные.',
    ],
    Рыбы: [
      'Творческая энергия переполняет тебя сегодня.',
      'Интуиция подскажет верный путь.',
      'День подходит для духовных практик и медитации.',
      'Твоя эмпатия поможет понять других.',
      'Время для мечтаний - они могут стать реальностью.',
      'Сегодня важно прислушаться к своему внутреннему голосу.',
      'Твоя чувствительность - дар, не слабость.',
    ],
  },
  love: {
    Овен: [
      'Страсть вспыхнет с новой силой.',
      'Романтическое приключение на горизонте.',
      'Время проявить инициативу в отношениях.',
      'Любовь требует действий, а не слов.',
      'Новые встречи обещают быть яркими.',
      'Смелость привлечёт внимание.',
      'Огонь страсти разгорается!',
    ],
    Телец: [
      'Стабильность в отношениях укрепляется.',
      'Романтический ужин создаст особую атмосферу.',
      'Время для тёплых признаний.',
      'Верность будет вознаграждена.',
      'Чувственные удовольствия на первом плане.',
      'Любовь требует терпения и заботы.',
      'Надёжность привлекает.',
    ],
    Близнецы: [
      'Флирт и лёгкость в общении.',
      'Интеллектуальная связь важнее страсти.',
      'Разговоры сближают.',
      'Новое знакомство может перерасти в роман.',
      'Игривость привлечёт внимание.',
      'Время для приятных сюрпризов.',
      'Общение - путь к сердцу.',
    ],
    Рак: [
      'Эмоциональная близость укрепляется.',
      'Домашний уют создаёт романтику.',
      'Забота о партнёре принесёт радость.',
      'Глубокие чувства выходят на поверхность.',
      'Время для откровенных разговоров.',
      'Нежность и понимание важнее слов.',
      'Интуиция подскажет, как действовать.',
    ],
    Лев: [
      'Время блистать для любимого человека.',
      'Романтические жесты произведут впечатление.',
      'Щедрость в любви окупится.',
      'Страсть и драма на пике.',
      'Время для роскошных свиданий.',
      'Гордость не должна мешать любви.',
      'Сердце требует праздника!',
    ],
    Дева: [
      'Внимание к деталям укрепит отношения.',
      'Практическая помощь - тоже проявление любви.',
      'Время навести порядок в чувствах.',
      'Скромность привлекательна.',
      'Заботливость будет замечена.',
      'Время для честного разговора.',
      'Идеальных отношений не бывает, и это нормально.',
    ],
    Весы: [
      'Гармония в паре на первом месте.',
      'Романтика витает в воздухе.',
      'Время для совместных решений.',
      'Красота и эстетика в отношениях.',
      'Компромисс укрепит союз.',
      'Партнёрство расцветает.',
      'Баланс между личным и общим.',
    ],
    Скорпион: [
      'Глубина чувств поражает.',
      'Страсть и интенсивность.',
      'Время для полной отдачи.',
      'Ревность может навредить.',
      'Трансформация отношений.',
      'Доверие - ключ к близости.',
      'Интимность на новом уровне.',
    ],
    Стрелец: [
      'Приключения в паре!',
      'Свобода в отношениях важна.',
      'Путешествие укрепит любовь.',
      'Оптимизм привлекает.',
      'Новые горизонты вместе.',
      'Честность в чувствах.',
      'Веселье и лёгкость.',
    ],
    Козерог: [
      'Серьёзные намерения.',
      'Время для планов на будущее.',
      'Стабильность в отношениях.',
      'Ответственность привлекает.',
      'Долгосрочная перспектива.',
      'Время для важных решений.',
      'Надёжность партнёра важна.',
    ],
    Водолей: [
      'Дружба - основа любви.',
      'Нестандартные отношения.',
      'Свобода в паре.',
      'Интеллектуальная связь.',
      'Время для экспериментов.',
      'Уникальность притягивает.',
      'Независимость в отношениях.',
    ],
    Рыбы: [
      'Романтика и мечты.',
      'Духовная связь с партнёром.',
      'Интуиция в любви.',
      'Время для нежности.',
      'Сострадание укрепляет союз.',
      'Мечты о любви могут сбыться.',
      'Эмоциональная глубина.',
    ],
  },
  moods: ['Энергичный', 'Спокойный', 'Мечтательный', 'Решительный', 'Творческий', 'Романтичный', 'Задумчивый'],
  colors: ['золотой', 'серебряный', 'розовый', 'фиолетовый', 'изумрудный', 'синий', 'красный'],
}

// Совместимость знаков
const compatibility: Record<ZodiacSign, ZodiacSign[]> = {
  Овен: ['Лев', 'Стрелец', 'Близнецы', 'Водолей'],
  Телец: ['Дева', 'Козерог', 'Рак', 'Рыбы'],
  Близнецы: ['Весы', 'Водолей', 'Овен', 'Лев'],
  Рак: ['Скорпион', 'Рыбы', 'Телец', 'Дева'],
  Лев: ['Овен', 'Стрелец', 'Близнецы', 'Весы'],
  Дева: ['Телец', 'Козерог', 'Рак', 'Скорпион'],
  Весы: ['Близнецы', 'Водолей', 'Лев', 'Стрелец'],
  Скорпион: ['Рак', 'Рыбы', 'Дева', 'Козерог'],
  Стрелец: ['Овен', 'Лев', 'Весы', 'Водолей'],
  Козерог: ['Телец', 'Дева', 'Скорпион', 'Рыбы'],
  Водолей: ['Близнецы', 'Весы', 'Овен', 'Стрелец'],
  Рыбы: ['Рак', 'Скорпион', 'Телец', 'Козерог'],
}

// Генерация псевдо-случайного числа на основе даты
function seededRandom(seed: number): number {
  const x = Math.sin(seed) * 10000
  return x - Math.floor(x)
}

// Получить сегодняшний seed
function getTodaySeed(): number {
  const today = new Date()
  return today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate()
}

// Получить индекс для знака на сегодня
function getIndexForSign(sign: ZodiacSign, category: string): number {
  const seed = getTodaySeed()
  const signIndex = Object.keys(horoscopeDatabase.general).indexOf(sign)
  const categoryIndex = ['general', 'love', 'mood', 'color'].indexOf(category)
  return Math.floor(seededRandom(seed + signIndex * 100 + categoryIndex * 10) * 7)
}

export function getDailyHoroscope(sign: ZodiacSign | undefined): DailyHoroscope | null {
  if (!sign) return null

  const generalIndex = getIndexForSign(sign, 'general')
  const loveIndex = getIndexForSign(sign, 'love')
  const moodIndex = getIndexForSign(sign, 'mood')
  const colorIndex = getIndexForSign(sign, 'color')

  const seed = getTodaySeed()
  const signIndex = Object.keys(horoscopeDatabase.general).indexOf(sign)
  const luckyNumber = Math.floor(seededRandom(seed + signIndex * 50) * 99) + 1

  const compatibleSigns = compatibility[sign]
  const compatIndex = Math.floor(seededRandom(seed + signIndex * 30) * compatibleSigns.length)

  return {
    general: horoscopeDatabase.general[sign][generalIndex],
    love: horoscopeDatabase.love[sign][loveIndex],
    career: 'Профессиональные достижения сегодня зависят от твоего настроя.',
    health: 'Прислушайся к своему телу и дай ему отдых.',
    luckyNumber,
    luckyColor: horoscopeDatabase.colors[colorIndex],
    mood: horoscopeDatabase.moods[moodIndex],
    compatibility: compatibleSigns[compatIndex],
  }
}

// Получить эмодзи для знака
export function getZodiacSymbol(sign: ZodiacSign | undefined): string {
  if (!sign) return '?'
  const symbols: Record<ZodiacSign, string> = {
    Овен: '♈',
    Телец: '♉',
    Близнецы: '♊',
    Рак: '♋',
    Лев: '♌',
    Дева: '♍',
    Весы: '♎',
    Скорпион: '♏',
    Стрелец: '♐',
    Козерог: '♑',
    Водолей: '♒',
    Рыбы: '♓',
  }
  return symbols[sign]
}

// Порядок знаков зодиака
const zodiacOrder: ZodiacSign[] = [
  'Овен', 'Телец', 'Близнецы', 'Рак',
  'Лев', 'Дева', 'Весы', 'Скорпион',
  'Стрелец', 'Козерог', 'Водолей', 'Рыбы'
]

// Расчёт асцендента по дате и времени рождения
// Асцендент - знак зодиака, восходящий на востоке в момент рождения
// Формула: асцендент зависит от местного звёздного времени (LST)
export function calculateAscendant(
  birthTime: string | undefined,
  zodiacSign: ZodiacSign | undefined,
  birthDate?: Date
): ZodiacSign | null {
  if (!birthTime || !zodiacSign) return null

  // Парсим время (формат HH:MM или HH.MM)
  const timeParts = birthTime.replace('.', ':').split(':')
  if (timeParts.length < 2) return null

  const hours = parseInt(timeParts[0], 10)
  const minutes = parseInt(timeParts[1], 10)

  if (isNaN(hours) || isNaN(minutes)) return null
  if (hours < 0 || hours > 23 || minutes < 0 || minutes > 59) return null

  // Получаем индекс солнечного знака
  const sunSignIndex = zodiacOrder.indexOf(zodiacSign)
  if (sunSignIndex === -1) return null

  // Используем дату рождения или текущую дату для расчёта
  const date = birthDate || new Date()

  // Расчёт дня года (1-365)
  const startOfYear = new Date(date.getFullYear(), 0, 0)
  const diff = date.getTime() - startOfYear.getTime()
  const dayOfYear = Math.floor(diff / (1000 * 60 * 60 * 24))

  // Приблизительное местное звёздное время (LST)
  // LST ≈ (день года × 0.9856) + (часы × 1.0027) + корректировка
  // Упрощённая формула для средних широт
  const decimalTime = hours + minutes / 60

  // Звёздное время в часах (0-24)
  // На каждый день года звёздное время сдвигается примерно на 4 минуты (0.0657 часа)
  let siderealTime = (dayOfYear * 0.0657 + decimalTime * 1.0027 + 12) % 24

  // Преобразуем звёздное время в знак зодиака
  // Каждые 2 часа звёздного времени = новый знак (24 часа / 12 знаков)
  // 0:00 LST = Овен восходит (примерно в весеннее равноденствие)
  const ascendantIndex = Math.floor(siderealTime / 2) % 12

  return zodiacOrder[ascendantIndex]
}

// Описания асцендентов в дружеском стиле
export function getAscendantDescription(ascendant: ZodiacSign): string {
  const descriptions: Record<ZodiacSign, string> = {
    Овен: 'Ты излучаешь энергию и решительность! Люди видят в тебе лидера, которая не боится идти первой.',
    Телец: 'Ты производишь впечатление надёжной и уверенной в себе. Твоё спокойствие притягивает.',
    Близнецы: 'Ты кажешься общительной и лёгкой на подъём! Твоя любознательность заразительна.',
    Рак: 'Ты излучаешь тепло и заботу. Люди чувствуют себя защищёнными рядом с тобой.',
    Лев: 'Ты сияешь! Твоя харизма и уверенность притягивают внимание, даже когда ты этого не хочешь.',
    Дева: 'Ты производишь впечатление собранной и внимательной. Твоя практичность внушает доверие.',
    Весы: 'Ты очаровываешь своей элегантностью и дипломатичностью. Гармония - твой стиль.',
    Скорпион: 'В тебе чувствуется глубина и магнетизм. Твой взгляд проникает в душу.',
    Стрелец: 'Ты светишься оптимизмом и жаждой приключений! Твой энтузиазм заражает.',
    Козерог: 'Ты выглядишь серьёзной и целеустремлённой. Твоя амбициозность вдохновляет.',
    Водолей: 'Ты кажешься уникальной и независимой. Твоя оригинальность притягивает единомышленников.',
    Рыбы: 'Ты излучаешь мечтательность и сострадание. Твоя интуиция чувствуется сразу.',
  }
  return descriptions[ascendant]
}
